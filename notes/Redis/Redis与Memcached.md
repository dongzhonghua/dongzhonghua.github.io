[TOC]

## 背景

之前只知道MC只能存储字符串，后来再一次组会上听几个大佬分享了关于他们用mc的一些实践，有了他们的经历我再来详细讨论一下Redis和mc的一些区别和选型上的一些问题。



他们两个都各有优缺点，做技术的，实现一个功能也肯定有很多个方法，具体选择哪一个要综合考虑他们两者的优缺点。技术有时候不能光看牛逼不牛逼，大部分时候还是要看业务场景适合不适合，系统稳定不稳定。

## redis与memcached对比

### 1、数据类型

Redis支持丰富的数据类型，比如string、hash、list、set、zset。

Memcached只支持简单的key/value数据结构。

### 2、单线程/多线程/承载QPS

Redis是单线程请求，所有命令串行执行，并发情况下不需要考虑数据一致性问题；性能受限于CPU，单实例QPS可以达到写8w qps，读10w qps。

Memcached是多线程，可以利用多核优势，单实例在正常情况下，可以达到写入60-80w qps，读80-100w qps。

### 3、持久化/数据迁移

Redis支持持久化操作，可以进行aof及rdb数据持久化到磁盘。

Memcached无法进行持久化，数据不能备份，只能用于缓存使用，且重启后数据全部丢失。

### 4、对热点、bigkey支持的友好度

Redis的big key与热key类操作，如果qps较高则容易造成redis阻塞，影响整体请求。

Memcached因为是多线程，与redis相比，在big key与热key类操作上支持较好。

### 5、高可用/HA

Redis支持通过Replication进行数据复制，通过master-slave机制，可以实时进行数据的同步复制，

支持多级复制和增量复制，master-slave机制是Redis进行HA的重要手段。

Memcached无法进行数据同步，不能将实例中的数据迁移到其他MC实例中。

### 6、发布订阅机制

Redis支持pub/sub消息订阅机制，可以用来进行消息订阅与通知。

Memcached不支持发布订阅。

### 7、周边支持

Redis相对memcached，周边工具支持较好，比如迁移、数据分析等方便，目前KCC支持全量和指定前缀等数据分析和删除功能。

Memcched周边支持较少，且原生不支持key分析等操作



在平时的业务场景中，我们都是用的Redis，无需多言，Redis的生态更加完善，功能非常多，但是在有一个场景下要求非常高的QPS，使用Redis的话需要多个实例，机器成本非常大。所以我们的实现方案是采用memecached双机房双活，一共四个实例。写的时候双写，读的时候先读其中一个集群，如果没有则读另一个集群并回写。这样可以保证可用性。这样的话最高支持了一千万的qps。