[TOC]

# Redis深度离线读书笔记

值得新建一个页面的就新建一个页面，比较小的功能就集中在这里记录。

## redis实现简单限流

使用zset数据结构，score使用当前时间戳。只需要使用zrange来查看一段时间内的次数就可以实现限流。



### 漏斗限流算法

* [限流算法](../../21.02/限流算法整理.md)

可以将漏斗限流算法的相关字段存储到一个hash结构中，在内存里运算之后在回填到hash结构中，这三个过程不是原子化，所以需要进行适当的加锁，而一旦加锁就需要考虑加锁失败的重试放弃等，比较麻烦。

还好有Redis-cell

### Redis cell

使用漏斗算法，提供了原子的限流指令。

## 找出满足特定前缀的key

keys 但是keys缺点比较多，不建议用

scan，这个功能比较多

### scan原理

Redis中的所有key都是存在一个很大的字典里，和java里的HashMap类似。scan指令返回的游标是第一维数组的位置。凡是当前的槽可能有链表或者没有链表。所以返回值可多可少。

scan遍历的方式是采用高进位加法。避免了字典的扩容和缩容导致的重复和遗漏。