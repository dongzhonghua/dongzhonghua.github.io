

工作中有很多个测试机器，很多时候都需要往测试机中传文件，我一般的做法是采用命令行的方式，但是这种方法非常的繁琐，需要敲命令，非常的不方便，而且我大部分的场景都是把idea中项目的一些文件发送到测试机。所以我就有了写一个插件的想法。

总体来说，应该分为两个部分，一个是服务器的接受方，一个是idea插件获取文件并发送。

在开发这个小功能的过程中，遇到了如干的问题，通过这些问题，我还是学到了很多的，完成之后我发现虽然只是实现了一个简单的功能，但是通过里面遇到的问题和我解决的过程还是收获非常大的。



**如何写一个插件：**写一个插件过程中我还是遇到了很多问题的，在第一步我就差点进行不下去，主要还是搭建一个插件的环境比较麻烦。最终我采用的是gradle的方式，插件选择下面两个：

```
plugins {
    id 'java'
    id 'org.jetbrains.intellij' version '0.7.2'
}
```

首先他会下载一个非常大的开发包，过程中还有各种版本问题，最后光是折腾环境就花了一天。第二个问题是idea的插件的界面是用swing写的，对于这个我不是很熟悉，比如各种修改点击事件等等，我都是自己一个一个试出来的。还有就是改完代码之后重启插件的过程需要耗费几十秒，对于调试还是比较难得，而且大部分的代码只能靠输出来调试，比较麻烦。

**多个服务器如何灵活选择：**这个是最难花时间最多的地方，由于可能需要向多个服务器中传文件，我这是选用的方案是用nacos做注册中心，在idea中输入注册中心地址，然后选择要上传的服务器。这个过程中还是花了较长的时间的。

**传输文件遇到的问题：** 涉及到文件，主要还是版本不兼容的问题，我插件中用的是retrofit，转到spring之后是multipartFile，导致文件格式比较难适配。当然还有retrofit的版本不一致导致了很多问题。我发现版本不一致导致的问题，我在这里就遇到了两个。这里顺便吐槽一下Java的网络传输客户端虽然有很多也能实现很复杂的功能，但是我还是喜欢Python的requests库。

最终的效果如下如所示：

![image-20210427220124819](https://gitee.com/dongzhonghua/zhonghua/raw/master/img/blog/%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0%E6%B5%8B%E8%AF%95%E6%9C%BA%E6%88%AA%E5%9B%BE.png)

整个的架构图：

![image-20210427221828736](https://gitee.com/dongzhonghua/zhonghua/raw/master/img/blog/%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0%E6%B5%8B%E8%AF%95%E6%9C%BA%E6%9E%B6%E6%9E%84%E5%9B%BE.png)

