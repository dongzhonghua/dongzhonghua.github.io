# 计算机网络常见面试题



## OSI，TCP/IP，五层协议的体系结构，以及各层协议

<img src="https://images2018.cnblogs.com/blog/1118296/201806/1118296-20180612150319215-132711209.jpg" style="zoom:50%;" />

### 1. 物理层

激活、维持、关闭通信端点之间的机械特性、电气特性、功能特性以及过程特性。该层为上层协议提供了一个传输数据的可靠的物理媒体。简单的说，物理层确保原始的数据可在各种物理媒体上传输。物理层记住两个重要的设备名称，中继器（Repeater，也叫放大器）和集线器。

### 2. 数据链路层

数据链路层在物理层提供的服务的基础上向网络层提供服务，其最基本的服务是将源自网络层来的数据**可靠地传输到相邻节点的目标机网络层**。所以这一层需要： 如何将数据组合成数据块，在数据链路层中称这种数据块为帧（frame），帧是数据链路层的传送单位；如何控制帧在物理信道上的传输，包括如何处理传输差错，如何调节发送速率以使与接收方相匹配；以及在两个网络实体之间提供数据链路通路的建立、维持和释放的管理。 数据链路层在不可靠的物理介质上提供可靠的传输。该层的作用包括：**物理地址寻址、数据的成帧、流量控制、数据的检错、重发等** 。主要的协议是以太网协议，设备主要是网桥和交换机。

### 3. 网络层

网络层的目的是**实现两个主机系统之间的数据透明传送**，具体功能包括寻址和路由选择、连接的建立、保持和终止等。它提供的服务使传输层不需要了解网络中的数据传输和交换技术。如果您想用尽量少的词来记住网络层，那就是**“路径选择、路由及逻辑寻址”**。 
最重要的协议，也是TCP/IP的核心协议——IP协议。**IP协议非常简单，仅仅提供不可靠、无连接的传送服务**。IP协议的主要功能有：无连接数据报传输、数据报路由选择和差错控制。与IP协议配套使用实现其功能的还有地址解析协议ARP、逆地址解析协议RARP、因特网报文协议ICMP、因特网组管理协议IGMP。 网络层基本数据单位为ip数据报。重要的设备有路由器。

### 4. 传输层

传输层负责将上层数据分段并提供端到端的、可靠的或不可靠的传输。此外，传输层还要处理端到端的差错控制和流量控制问题。
传输层的任务是根据通信子网的特性，最佳的利用网络资源，为两个端系统的会话层之间，提供建立、维护和取消传输连接的功能，负责端到端的可靠数据传输。在这一层，信息传送的协议数据单元称为段或报文。作用：**为应用进程之间提供端到端的逻辑通信。**
**网络层只是根据网络地址将源结点发出的数据包传送到目的结点，而传输层则负责将数据可靠地传送到相应的端口**。 
包含的主要协议：TCP协议（Transmission Control Protocol，传输控制协议）、UDP协议（User Datagram Protocol，用户数据报协议）。重要的设备有网关。

### 5. 会话层

会话层**管理主机之间的会话进程，即负责建立、管理、终止进程之间的会话**。会话层还利用在数据中插入校验点来实现数据的同步。 

### 6. 表示层

表示层**对上层数据或信息进行变换以保证一个主机应用层信息可以被另一个主机的应用程序理解**。表示层的数据转换包括**数据的加密、压缩、格式转换**等。 

### 7. 应用层

**为用户的应用程序提供网络服务的接口**。**将用户的操作通过应用程序转换成为服务，并匹配一个相应的服务协议发送给传输层**。基本单位为报文。
注：我们在传输数据时，可以只使用（传输层）TCP/IP协议，但是那样的话，如果没有应用层，便无法识别数据内容，如果想要使传输的数据有意义，则必须使用到应用层协议。

| 层   | 协议 |设备|
| ---- | ---- | ---- |
|物理层|RJ45、CLOCK、IEEE802.3|中继器，集线器，网关|
|数据链路|PPP、FR、HDLC、VLAN、MAC|网桥，交换机|
|网络层|IP、ICMP、ARP、RARP、OSPF、IPX、RIP、IGRP|路由器|
|传输层|TCP、UDP、SPX||
|会话层|NFS、SQL、NETBIOS、RPC||
|表示层|JPEG、MPEG、ASCII||
|应用层|FTP、DNS、Telnet、SMTP、HTTP、WWW、NFS||

## 应用层和传输层的关系

传输层协议添加端口就可以标识应用层协议。应用层协议代表着服务器上的服务，服务器上的服务如果对客户端提供服务，**必须在TCP或UDP端口侦听客户端的请求**。
传输层的协议TCP或UDP加上端口就可以标识一个应用层协议，TCP/IP协议中的端口范围是从0～65535。 
 IP 地址与网络服务的关系是**一对多**的关系。实际上是通过**"IP地址+端口号"**来区分不同的服务的。 

## tcp和udp的区别

- TCP面向连接，UDP面向非连接即发送数据前不需要建立链接
- TCP提供可靠的服务（数据传输），UDP无法保证
- TCP面向字节流，UDP面向报文
- TCP数据传输慢，UDP数据传输快
- TCP提供一种面向连接的、可靠的字节流服务
- 在一个TCP连接中，仅有两方进行彼此通信，因此广播和多播不能用于TCP
- TCP使用校验和，确认和重传机制来保证可靠传输
- TCP使用累积确认
- TCP使用滑动窗口机制来实现流量控制，通过动态改变窗口的大小进行拥塞控制

## TCP中的流量控制和拥塞控制--tcp如何保证传输的可靠性

- **流量控制**主要针对的是端到端传输中控制流量大小并保证传输可靠性（**未收到ack就不滑动**）。流量控制往往是指点对点通信量的控制，所要做的是**抑制发送端发送数据的速率**，要让接收方来得及接收。
  利用**滑动窗口**可以非常方便的实现流量控制。
- **拥塞控制**主要是一个全局性过程，涉及到所有主机，路由器，以及与降低网络传输性能有关的所有因素。**防止过多的数据注入到网络中**。如果有发生丢包则通过拥塞控制减小窗口，确定出合适(**慢启动 拥塞避免 快重传 快恢复**)的拥塞窗口（**增性加乘性减**）。

## DNS域名系统，简单描述其工作原理。

## 在浏览器输入 URL 回车之后发生了什么？
1. URL 解析
2. DNS 查询
3. TCP 连接
4. 处理请求
5. 接受响应
6. 渲染页面

###  1）URL解析

首先判断你输入的是一个合法的 URL 还是一个待搜索的关键词，并且根据你输入的内容进行自动完成、字符编码等操作。

<img src="http://47.94.229.159:9001/images/%E6%A3%80%E6%9F%A5%E7%BC%93%E5%AD%98.png" style="zoom: 50%;" />

### 2）DNS查询

<img src="http://47.94.229.159:9001/images/find%20dns.png" style="zoom:33%;" />

浏览器会先检查是否在缓存中，没有则调用系统库函数进行查询。
操作系统也有自己的 DNS缓存，但在这之前，会向检查域名是否存在本地的 Hosts 文件里，没有则向 DNS 服务器发送查询请求。
路由器也有自己的缓存。
ISP DNS 就是在客户端电脑上设置的首选 DNS 服务器，它们在大多数情况下都会有缓存。

### 3）TCP连接

**1**. **应用层：发送** **HTTP** **请求**

在前面的步骤我们已经得到服务器的 IP 地址，浏览器会开始构造一个 HTTP 报文，其中包括：
- 请求报头（Request Header）：请求方法、目标地址、遵循的协议等等
- 请求主体（其他参数）
其中需要注意的点：
- 浏览器只能发送 GET、POST 方法，而打开网页使用的是 GET 方法，ajax可以发送别的请求。

**2.** **传输层：**TCP传输报文

传输层会发起一条到达服务器的 TCP 连接，为了方便传输，会对数据进行分割（以报文段为单位），并标记编号，方便服务器接受时能够准确地还原报文信息。在建立连接前，会先进行 TCP 三次握手。结束之后是四次挥手。 

HTTP会话请求分成报文段，添加源和目的端口，如服务器使用80端口监听客户端的请求，客户端由系统随机选择一个端口如5000，与服务器进行交换，服务器把相应的请求返回给客户端的5000端口。然后使用IP层（网络层）的IP地址查找目的端。 

**3.** **网络层：IP协议查询Mac地址**

将数据段打包，并加入源及目标的IP地址，并且负责寻找传输路线。
判断目标地址是否与当前地址处于同一网络中，是的话直接根据 Mac 地址发送，否则使用路由表查找下一跳地址，以及使用 ARP 协议查询它的 Mac 地址。

**4.** **链路层：以太网协议**

**以太网协议**

根据以太网协议将数据分为以“帧”为单位的数据包，每一帧分为两个部分：

- 标头：数据包的发送者、接受者、数据类型
- 数据：数据包具体内容

**Mac 地址**

以太网规定了连入网络的所有设备都必须具备“网卡”接口，数据包都是从一块网卡传递到另一块网卡，网卡的地址就是 Mac 地址。每一个 Mac 地址都是独一无二的，具备了一对一的能力。

**广播**

发送数据的方法很原始，直接把数据通过 ARP 协议，向本网络的所有机器发送，接收方根据标头信息与自身 Mac 地址比较，一致就接受，否则丢弃。

### 4）服务器处理请求

**HTTPD**

最常见的 HTTPD 有 Linux 上常用的 Apache 和 Nginx，以及 Windows 上的 IIS。

**处理请求**

接受 TCP 报文后，会对连接进行处理，对HTTP协议进行解析

### 5）浏览器接受响应

浏览器接收到来自服务器的响应资源后，会对资源进行分析。
首先查看 Response header，根据不同状态码做不同的事（比如上面提到的重定向）。
如果响应资源进行了压缩（比如 gzip），还需要进行解压。
然后，对响应资源做缓存。

### 6）渲染页面

不同的浏览器内核，渲染过程也不完全相同，但大致流程都差不多。
<img src="http://47.94.229.159:9001/images/xrrj.png" style="zoom:33%;" />

## Socket

### 1.什么是Socket？比较好的一个[网站]( https://www.cnblogs.com/wangcq/p/3520400.html )

上面我们已经知道网络中的进程是通过socket来通信的，那什么是socket呢？socket起源于Unix，而Unix/Linux基本哲学之一就是“一切皆文件”，都可以用“打开open –> 读写write/read –> 关闭close”模式来操作。我的理解就是Socket就是该模式的一个实现，socket即是一种特殊的文件，一些socket函数就是对其进行的操作（读/写IO、打开、关闭）。

<img src="http://47.94.229.159:9001/images/socket%E5%92%8C%E5%90%84%E5%8D%8F%E8%AE%AE%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB.jpg" style="zoom:50%;" />

<img src="http://47.94.229.159:9001/images/socket%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B.jpg" style="zoom:50%;" />

 三次握手发生在socket的那几个函数中呢？ 

<img src="http://47.94.229.159:9001/images/socket%E5%92%8C%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png" style="zoom:50%;" />

## HTTP与HTTPS区别

1. https协议需要到ca申请证书，一般免费证书较少，因而需要一定费用。
2. http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。
3. http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。
4. http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。

### http长连接与短连接

**在HTTP/1.0中默认使用短连接。也就是说，客户端和服务器每进行一次HTTP操作，就建立一次连接，任务结束就中断连接**。当客户端浏览器访问的某个HTML或其他类型的Web页中包含有其他的Web资源（如JavaScript文件、图像文件、CSS文件等），每遇到这样一个Web资源，浏览器就会重新建立一个HTTP会话。
而从HTTP/1.1起，默认使用长连接，用以保持连接特性。使用长连接的HTTP协议，会在响应头加入这行代码：
```
Connection:keep-alive
```
**在使用长连接的情况下，当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的TCP连接不会关闭，客户端再次访问这个服务器时，会继续使用这一条已经建立的连接**。Keep-Alive不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如Apache）中设定这个时间。实现长连接需要客户端和服务端都支持长连接。本质还是tcp和长连接和短连接。

## session和cookies的区别

1. http是无状态的协议，所以服务器就给每个用户颁发一个通行证，每次请求就带上自己的通行证。cookie数据存放在客户的浏览器上，session数据放在服务器上。
2. cookie不是很安全，别人可以分析存放在本地的COOKIE并进行COOKIE欺骗,考虑到安全应当使用session。
3. session会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能,考虑到减轻服务器性能方面，应当使用COOKIE，session是基于Cookie技术实现，重启浏览器后再次访问原有的连接依然会创建一个新的session，因为Cookie在关闭浏览器后就会消失，但是原来服务器的Session还在，只有等到了销毁的时间会自动销毁。Session是保存在服务器端上会存在一段时间才会消失，如果session过多会增加服务器的压力 
4. 单个cookie保存的数据不能超过4K，很多浏览器都限制一个站点最多保存20个cookie。
5. 所以个人建议：
    将登陆信息等重要信息存放为SESSION
    其他信息如果需要保留，可以放在COOKIE中
6. spring-session 用到了redis，session存储到redis里面，可以共享session。在服务器集群的场景下可以使用。

## Token

1. 一般在前后端分离的时候会用到。Token 是在服务端产生的。如果前端使用用户名/密码向服务端请求认证，服务端认证成功，那么在服务端会返回 Token 给前端。前端可以在每次请求的时候带上 Token 证明自己的合法地位。如果这个 Token 在服务端持久化（比如存入数据库），那它就是一个永久的身份令牌。Token可以减轻服务器的压力，减少频繁的查询数据库，使服务器更加健壮。 

  

